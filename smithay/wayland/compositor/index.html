<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities for handling surfaces, subsurfaces and regions"><title>smithay::wayland::compositor - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smithay" data-themes="" data-resource-suffix="" data-rustdoc-version="1.92.0-nightly (7ac0330c6 2025-09-25)" data-channel="nightly" data-search-js="search-e256b49e.js" data-stringdex-js="stringdex-061df703.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module compositor</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../smithay/index.html">smithay</a><span class="version">0.7.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module compositor</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#why-use-this-implementation" title="Why use this implementation">Why use this implementation</a></li><li><a href="#how-to-use-it" title="How to use it">How to use it</a><ul><li><a href="#initialization" title="Initialization">Initialization</a></li><li><a href="#use-the-surface-states" title="Use the surface states">Use the surface states</a></li><li><a href="#state-application-and-hooks" title="State application and hooks">State application and hooks</a></li><li><a href="#surface-roles" title="Surface roles">Surface roles</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In smithay::<wbr>wayland</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">smithay</a>::<wbr><a href="../index.html">wayland</a></div><h1>Module <span>compositor</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/smithay/wayland/compositor/mod.rs.html#1-805">Source</a> </span></div><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>wayland_frontend</code></strong> only.</div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities for handling surfaces, subsurfaces and regions</p>
<p>This module provides automatic handling of surfaces, subsurfaces
and region Wayland objects, by registering an implementation for
for the <a href="../../../wayland_server/protocol/wl_compositor/index.html" title="mod wayland_server::protocol::wl_compositor"><code>wl_compositor</code></a>
and <a href="../../../wayland_server/protocol/wl_subcompositor/index.html" title="mod wayland_server::protocol::wl_subcompositor"><code>wl_subcompositor</code></a> globals.</p>
<h3 id="why-use-this-implementation"><a class="doc-anchor" href="#why-use-this-implementation">§</a>Why use this implementation</h3>
<p>This implementation does a simple job: it stores in a coherent way the state of
surface trees with subsurfaces, to provide you direct access to the tree
structure and all surface attributes, and handles the application of double-buffered
state.</p>
<p>As such, you can, given a root surface with a role requiring it to be displayed,
you can iterate over the whole tree of subsurfaces to recover all the metadata you
need to display the subsurface tree.</p>
<p>This implementation will not do anything more than present you the metadata specified by the
client in a coherent and practical way. All the logic regarding drawing itself, and
the positioning of windows (surface trees) one relative to another is out of its scope.</p>
<h3 id="how-to-use-it"><a class="doc-anchor" href="#how-to-use-it">§</a>How to use it</h3><h4 id="initialization"><a class="doc-anchor" href="#initialization">§</a>Initialization</h4>
<p>To initialize this implementation create the <a href="struct.CompositorState.html" title="struct smithay::wayland::compositor::CompositorState"><code>CompositorState</code></a>, store it inside your <code>State</code> struct
and implement the <a href="trait.CompositorHandler.html" title="trait smithay::wayland::compositor::CompositorHandler"><code>CompositorHandler</code></a>, as shown in this example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>smithay::delegate_compositor;
<span class="kw">use </span>smithay::wayland::compositor::{CompositorState, CompositorClientState, CompositorHandler};

<span class="comment">// Create the compositor state
</span><span class="kw">let </span>compositor_state = CompositorState::new::&lt;State&gt;(
    <span class="kw-2">&amp;</span>display.handle(),
);

<span class="comment">// insert the CompositorState into your state
// ..

// implement the necessary traits
</span><span class="kw">impl </span>CompositorHandler <span class="kw">for </span>State {
   <span class="kw">fn </span>compositor_state(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;mut </span>CompositorState {
       <span class="kw-2">&amp;mut </span><span class="self">self</span>.compositor_state
   }

   <span class="kw">fn </span>client_compositor_state&lt;<span class="lifetime">'a</span>&gt;(<span class="kw-2">&amp;</span><span class="self">self</span>, client: <span class="kw-2">&amp;</span><span class="lifetime">'a </span>wayland_server::Client) -&gt; <span class="kw-2">&amp;</span><span class="lifetime">'a </span>CompositorClientState {
       <span class="kw-2">&amp;</span>client.get_data::&lt;ClientState&gt;().unwrap().compositor_state    
   }

   <span class="kw">fn </span>commit(<span class="kw-2">&amp;mut </span><span class="self">self</span>, surface: <span class="kw-2">&amp;</span>wayland_server::protocol::wl_surface::WlSurface) {
       <span class="comment">// called on every buffer commit.
       // .. your implementation ..
   </span>}
}
<span class="macro">delegate_compositor!</span>(State);

<span class="comment">// You're now ready to go!</span></code></pre></div><h4 id="use-the-surface-states"><a class="doc-anchor" href="#use-the-surface-states">§</a>Use the surface states</h4>
<p>The main access to surface states is done through the <a href="fn.with_states.html" title="fn smithay::wayland::compositor::with_states"><code>with_states</code></a> function, which
gives you access to the <a href="struct.SurfaceData.html" title="struct smithay::wayland::compositor::SurfaceData"><code>SurfaceData</code></a> instance associated with this surface. It acts
as a general purpose container for associating state to a surface, double-buffered or
not. See its documentation for more details.</p>
<h4 id="state-application-and-hooks"><a class="doc-anchor" href="#state-application-and-hooks">§</a>State application and hooks</h4>
<p>On commit of a surface several steps are taken to update the state of the surface. Actions
are taken by smithay in the following order:</p>
<ol>
<li>Pre Commit hooks registered to this surface are invoked. Such hooks can be registered using
the <a href="fn.add_pre_commit_hook.html" title="fn smithay::wayland::compositor::add_pre_commit_hook"><code>add_pre_commit_hook</code></a> function. They are typically used by protocol extensions that
add state to a surface and need to check on commit that client did not request an
illegal state before it is applied on commit.</li>
<li>The pending state is either applied and made current, or cached for later application
is the surface is a synchronize subsurface. If the current state is applied, state
of the synchronized children subsurface are applied as well at this point.</li>
<li>Post Commit hooks registered to this surface are invoked. Such hooks can be registered using
the <a href="fn.add_post_commit_hook.html" title="fn smithay::wayland::compositor::add_post_commit_hook"><code>add_post_commit_hook</code></a> function. They are typically used by abstractions that further process
the state.</li>
<li>Your implementation of <a href="trait.CompositorHandler.html#tymethod.commit" title="method smithay::wayland::compositor::CompositorHandler::commit"><code>CompositorHandler::commit</code></a> is invoked, so that you can access
the new current state of the surface. The state of sync children subsurfaces of your
surface may have changed as well, so this is the place to check it, using functions
like <a href="fn.with_surface_tree_upward.html" title="fn smithay::wayland::compositor::with_surface_tree_upward"><code>with_surface_tree_upward</code></a> or <a href="fn.with_surface_tree_downward.html" title="fn smithay::wayland::compositor::with_surface_tree_downward"><code>with_surface_tree_downward</code></a>. On the other hand,
if the surface is a sync subsurface, its current state will note have changed as
the result of that commit. You can check if it is using <a href="fn.is_sync_subsurface.html" title="fn smithay::wayland::compositor::is_sync_subsurface"><code>is_sync_subsurface</code></a>.</li>
<li>If the surface is destroyed, destruction hooks are invoked. Such hooks can be registered
using the <a href="fn.add_destruction_hook.html" title="fn smithay::wayland::compositor::add_destruction_hook"><code>add_destruction_hook</code></a> function. They are typically used to cleanup associated
state.</li>
</ol>
<h4 id="surface-roles"><a class="doc-anchor" href="#surface-roles">§</a>Surface roles</h4>
<p>The wayland protocol specifies that a surface needs to be assigned a role before it can
be displayed. Furthermore, a surface can only have a single role during its whole lifetime.
Smithay represents this role as a <code>&amp;'static str</code> identifier, that can only be set once
on a surface. See <a href="fn.give_role.html" title="fn smithay::wayland::compositor::give_role"><code>give_role</code></a> and <a href="fn.get_role.html" title="fn smithay::wayland::compositor::get_role"><code>get_role</code></a> for details. This module manages the
subsurface role, which is identified by the string <code>"subsurface"</code>.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AlreadyHasRole.html" title="struct smithay::wayland::compositor::AlreadyHasRole">Already<wbr>HasRole</a></dt><dd>An error type signifying that the surface already has a role and
cannot be assigned an other</dd><dt><a class="struct" href="struct.Barrier.html" title="struct smithay::wayland::compositor::Barrier">Barrier</a></dt><dd>A simple <a href="trait.Blocker.html" title="trait smithay::wayland::compositor::Blocker"><code>Blocker</code></a> barrier</dd><dt><a class="struct" href="struct.CachedState.html" title="struct smithay::wayland::compositor::CachedState">Cached<wbr>State</a></dt><dd>Double buffered cached state of type <code>T</code></dd><dt><a class="struct" href="struct.CompositorClientState.html" title="struct smithay::wayland::compositor::CompositorClientState">Compositor<wbr>Client<wbr>State</a></dt><dd>Per-client state of a compositor</dd><dt><a class="struct" href="struct.CompositorState.html" title="struct smithay::wayland::compositor::CompositorState">Compositor<wbr>State</a></dt><dd>State of a compositor</dd><dt><a class="struct" href="struct.HookId.html" title="struct smithay::wayland::compositor::HookId">HookId</a></dt><dd>Unique hook identifier used to unregister commit/descruction hooks</dd><dt><a class="struct" href="struct.MultiCache.html" title="struct smithay::wayland::compositor::MultiCache">Multi<wbr>Cache</a></dt><dd>A typemap-like container for double-buffered values</dd><dt><a class="struct" href="struct.RegionAttributes.html" title="struct smithay::wayland::compositor::RegionAttributes">Region<wbr>Attributes</a></dt><dd>Description of the contents of a region</dd><dt><a class="struct" href="struct.RegionUserData.html" title="struct smithay::wayland::compositor::RegionUserData">Region<wbr>User<wbr>Data</a></dt><dd>User data of WlRegion</dd><dt><a class="struct" href="struct.SubsurfaceCachedState.html" title="struct smithay::wayland::compositor::SubsurfaceCachedState">Subsurface<wbr>Cached<wbr>State</a></dt><dd>The cached state associated with a subsurface</dd><dt><a class="struct" href="struct.SubsurfaceUserData.html" title="struct smithay::wayland::compositor::SubsurfaceUserData">Subsurface<wbr>User<wbr>Data</a></dt><dd>User data of WlSubsurface</dd><dt><a class="struct" href="struct.SurfaceAttributes.html" title="struct smithay::wayland::compositor::SurfaceAttributes">Surface<wbr>Attributes</a></dt><dd>General state associated with a surface</dd><dt><a class="struct" href="struct.SurfaceData.html" title="struct smithay::wayland::compositor::SurfaceData">Surface<wbr>Data</a></dt><dd>The state container associated with a surface</dd><dt><a class="struct" href="struct.SurfaceUserData.html" title="struct smithay::wayland::compositor::SurfaceUserData">Surface<wbr>User<wbr>Data</a></dt><dd>User data for WlSurface</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.BlockerState.html" title="enum smithay::wayland::compositor::BlockerState">Blocker<wbr>State</a></dt><dd>States of a <a href="trait.Blocker.html" title="trait smithay::wayland::compositor::Blocker"><code>Blocker</code></a></dd><dt><a class="enum" href="enum.BufferAssignment.html" title="enum smithay::wayland::compositor::BufferAssignment">Buffer<wbr>Assignment</a></dt><dd>New buffer assignation for a surface</dd><dt><a class="enum" href="enum.Damage.html" title="enum smithay::wayland::compositor::Damage">Damage</a></dt><dd>Description of a part of a surface that
should be considered damaged and needs to be redrawn</dd><dt><a class="enum" href="enum.RectangleKind.html" title="enum smithay::wayland::compositor::RectangleKind">Rectangle<wbr>Kind</a></dt><dd>Kind of a rectangle part of a region</dd><dt><a class="enum" href="enum.TraversalAction.html" title="enum smithay::wayland::compositor::TraversalAction">Traversal<wbr>Action</a></dt><dd>Possible actions to do after handling a node during tree traversal</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.SUBSURFACE_ROLE.html" title="constant smithay::wayland::compositor::SUBSURFACE_ROLE">SUBSURFACE_<wbr>ROLE</a></dt><dd>The role of a subsurface surface.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.Blocker.html" title="trait smithay::wayland::compositor::Blocker">Blocker</a></dt><dd>Types potentially blocking state changes</dd><dt><a class="trait" href="trait.Cacheable.html" title="trait smithay::wayland::compositor::Cacheable">Cacheable</a></dt><dd>Trait representing a value that can be used in double-buffered storage</dd><dt><a class="trait" href="trait.CompositorHandler.html" title="trait smithay::wayland::compositor::CompositorHandler">Compositor<wbr>Handler</a></dt><dd>Handler trait for compositor</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.add_blocker.html" title="fn smithay::wayland::compositor::add_blocker">add_<wbr>blocker</a></dt><dd>Adds a blocker for the currently queued up state changes of the given surface.</dd><dt><a class="fn" href="fn.add_destruction_hook.html" title="fn smithay::wayland::compositor::add_destruction_hook">add_<wbr>destruction_<wbr>hook</a></dt><dd>Register a destruction hook to be invoked on surface destruction</dd><dt><a class="fn" href="fn.add_post_commit_hook.html" title="fn smithay::wayland::compositor::add_post_commit_hook">add_<wbr>post_<wbr>commit_<wbr>hook</a></dt><dd>Register a post-commit hook to be invoked on surface commit</dd><dt><a class="fn" href="fn.add_pre_commit_hook.html" title="fn smithay::wayland::compositor::add_pre_commit_hook">add_<wbr>pre_<wbr>commit_<wbr>hook</a></dt><dd>Register a pre-commit hook to be invoked on surface commit</dd><dt><a class="fn" href="fn.get_children.html" title="fn smithay::wayland::compositor::get_children">get_<wbr>children</a></dt><dd>Retrieve the children of this surface</dd><dt><a class="fn" href="fn.get_parent.html" title="fn smithay::wayland::compositor::get_parent">get_<wbr>parent</a></dt><dd>Retrieve the parent of this surface</dd><dt><a class="fn" href="fn.get_region_attributes.html" title="fn smithay::wayland::compositor::get_region_attributes">get_<wbr>region_<wbr>attributes</a></dt><dd>Retrieve the metadata associated with a <code>wl_region</code></dd><dt><a class="fn" href="fn.get_role.html" title="fn smithay::wayland::compositor::get_role">get_<wbr>role</a></dt><dd>Get the current role of this surface</dd><dt><a class="fn" href="fn.give_role.html" title="fn smithay::wayland::compositor::give_role">give_<wbr>role</a></dt><dd>Register that this surface has given role</dd><dt><a class="fn" href="fn.is_sync_subsurface.html" title="fn smithay::wayland::compositor::is_sync_subsurface">is_<wbr>sync_<wbr>subsurface</a></dt><dd>Check if this subsurface is a synchronized subsurface</dd><dt><a class="fn" href="fn.remove_destruction_hook.html" title="fn smithay::wayland::compositor::remove_destruction_hook">remove_<wbr>destruction_<wbr>hook</a></dt><dd>Unregister a destruction hook</dd><dt><a class="fn" href="fn.remove_post_commit_hook.html" title="fn smithay::wayland::compositor::remove_post_commit_hook">remove_<wbr>post_<wbr>commit_<wbr>hook</a></dt><dd>Unregister a post-commit hook</dd><dt><a class="fn" href="fn.remove_pre_commit_hook.html" title="fn smithay::wayland::compositor::remove_pre_commit_hook">remove_<wbr>pre_<wbr>commit_<wbr>hook</a></dt><dd>Unregister a pre-commit hook</dd><dt><a class="fn" href="fn.send_surface_state.html" title="fn smithay::wayland::compositor::send_surface_state">send_<wbr>surface_<wbr>state</a></dt><dd>Send the <code>scale</code> and <code>transform</code> preferences for the given surface when it supports them.</dd><dt><a class="fn" href="fn.with_states.html" title="fn smithay::wayland::compositor::with_states">with_<wbr>states</a></dt><dd>Access the states associated to this surface</dd><dt><a class="fn" href="fn.with_surface_tree_downward.html" title="fn smithay::wayland::compositor::with_surface_tree_downward">with_<wbr>surface_<wbr>tree_<wbr>downward</a></dt><dd>Access the data of a surface tree from top to bottom</dd><dt><a class="fn" href="fn.with_surface_tree_upward.html" title="fn smithay::wayland::compositor::with_surface_tree_upward">with_<wbr>surface_<wbr>tree_<wbr>upward</a></dt><dd>Access the data of a surface tree from bottom to top</dd></dl></section></div></main></body></html>